!function(){$(function(){function t(t){o.clear(),o.drawFlower($("#text").val(),35,35,r,t?200:0)}function R(){var t,R,e=$(".mode input.active");if($("#text").val()){var n=$("#text").val();"1"!=e.val()&&(n+="/"+e.val()),n=n.toBase64URI(),R=location.origin+"/r/"+n,t="'"+$("#text").val()+"' \u0437\u0430\u043a\u043e\u0434\u043e\u0432\u0430\u043d\u0435 \u0432\u0438\u0448\u0438\u0432\u043a\u043e\u044e. #\u0442\u0435\u043a\u0441\u0442\u043e\u0432\u0430\u0432\u0438\u0448\u0438\u0432\u043a\u0430"}else t="\u0422\u0435\u043a\u0441\u0442\u043e\u0432\u0430 \u0432\u0438\u0448\u0438\u0432\u043a\u0430",R=location.origin;var i=["facebook","googleplus","vkontakte","twitter"];$(".share-buttons").html("");
for(var r=0;r<i.length;r++) typeof(stWidget) !== 'undefined' && stWidget.addEntry({service:i[r],element:$(".share-buttons")[0],url:R,title:t,type:"large",image:$("#text").val()?"http://vyshyvka.ukrzen.in.ua/preview/"+decodeURIComponent($("#text").val())+".png":"http://vyshyvka.ukrzen.in.ua/preview.png"})}function e(){var t;$("#text").val()?(t="/word/"+decodeURIComponent($("#text").val()),$("title").text($("#text").val()+" - \u0422\u0435\u043a\u0441\u0442\u043e\u0432\u0430 \u0432\u0438\u0448\u0438\u0432\u043a\u0430")):(t="/",$("title").text("\u0422\u0435\u043a\u0441\u0442\u043e\u0432\u0430 \u0432\u0438\u0448\u0438\u0432\u043a\u0430"));var e=$(".mode input.active");"1"!=e.val()&&(t+="/"+e.val()),window.history.replaceState({word:$("#text").val()},"",t),R()}function n(t,R){var e=document.createElement("a");$(e).appendTo("body"),"download"in e&&(t=t.replace("image/png","image/octet-stream"),e.download=R),e.target="_blank",e.href=t,e.click(),$(e).remove()}function i(t){var R=$("#canvas")[0],e=R.getContext("2d"),n=R.width,i=R.height,r=e.getImageData(0,0,n,i),o={};o.x=9999,o.y=9999;var h={};for(h.x=-1,h.y=-1,y=0;y<i;y++)for(x=0;x<n;x++){var c=4*x+y*i*4;a=r.data[c+3],a>0&&(x<o.x&&(o.x=x),y<o.y&&(o.y=y),x>h.x&&(h.x=x),y>h.y&&(h.y=y))}var s=e.getImageData(o.x,o.y,h.x-o.x,h.y-o.y),d=$("#saveCanvas")[0];if(d.width=h.x-o.x,d.height=h.y-o.y,n=d.width,i=d.height,e=d.getContext("2d"),e.clearRect(0,0,n,i),e.putImageData(s,0,0),t){e.clearRect(0,0,n,i);var u=$("#bg");e.drawImage(u[0],(u.width()-n)/2,(u.height()-i)/2,n,i,0,0,n,i),e.drawImage(R,o.x,o.y,h.x-o.x,h.y-o.y,0,0,n,i)}}var r,o=new VCanvas($("#canvas"),10),h=!0;if(r="DIAGONAL_HORIZONTAL",o.drawMode="X",$(".overlay").on("click",function(){$(".overlay").addClass("hidden")}),$(".mode").on("click","input",function(){r=$(this).data("type"),$(this).parent().find("input").removeClass("active"),$(this).addClass("active"),h||(t(),e()),ga("send",{hitType:"event",eventCategory:"Main",eventAction:"Change mode",eventLabel:r,eventValue:1})}),$(".drawMode").on("click","input",function(){var R=$(this).data("type");o.colorMode="XCOLOR"==R?"MULTICOLOR":"",R="XCOLOR"==R?"X":R,o.drawMode=R,$(this).parent().find("input").removeClass("active"),$(this).addClass("active"),t(!1),ga("send",{hitType:"event",eventCategory:"Main",eventAction:"Change draw mode",eventLabel:R,eventValue:1})}),$("#help").on("click",function(){$(".overlay").removeClass("hidden"),ga("send",{hitType:"event",eventCategory:"Main",eventAction:"Help",eventLabel:$("#text").val(),eventValue:1})}),$("#save").on("click",function(){i("X"==o.drawMode),n($("#saveCanvas")[0].toDataURL("image/png"),$("#text").val()+".png"),ga("send",{hitType:"event",eventCategory:"Main",eventAction:"Download",eventLabel:$("#text").val(),eventValue:1}),s.preventDefault()}),$("form").on("submit",function(R){return-1!=$("#text").val().toLowerCase().indexOf("\u043f\u0443\u0442\u0456\u043d")||-1!=$("#text").val().toLowerCase().indexOf("\u043f\u0443\u0442\u0438\u043d")||-1!=$("#text").val().toLowerCase().indexOf("putin")?(alert("\u041d\u0430 \u0436\u0430\u043b\u044c, \u0446\u0435 \u0441\u043b\u043e\u0432\u043e \u043d\u0435 \u043c\u043e\u0436\u043d\u0430 \u0437\u0430\u043a\u043e\u0434\u0443\u0432\u0430\u0442\u0438 \u0432 \u0432\u0438\u0448\u0438\u0432\u0446\u0456 :("),void R.preventDefault()):(t(!0),e(),ga("send",{hitType:"event",eventCategory:"Main",eventAction:"Process",eventLabel:$("#text").val(),eventValue:1}),void R.preventDefault())}),location.pathname){var c=location.pathname.split("/",4);if("word"==c[1]){if(c[3])try{$($(".mode input")[parseInt(decodeURIComponent(c[3]))-1]).click()}catch(s){}$("#text").val(decodeURIComponent(c[2])),R(),setTimeout(function(){t(!1)},1),setTimeout(function(){t(!1)},2e3)}else R()}else R();({w:window});$(window).on("resize",function(){}),$(window).trigger("resize"),h=!1})}(),function(t){"use strict";var R,e=t.Base64,n="2.1.9";if("undefined"!=typeof module&&module.exports)try{R=require("buffer").Buffer}catch(i){}var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=function(t){for(var R={},e=0,n=t.length;n>e;e++)R[t.charAt(e)]=e;return R}(r),o=String.fromCharCode,h=function(t){if(t.length<2){var R=t.charCodeAt(0);return 128>R?t:2048>R?o(192|R>>>6)+o(128|63&R):o(224|R>>>12&15)+o(128|R>>>6&63)+o(128|63&R)}var R=65536+1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320);return o(240|R>>>18&7)+o(128|R>>>12&63)+o(128|R>>>6&63)+o(128|63&R)},c=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,s=function(t){return t.replace(c,h)},d=function(t){var R=[0,2,1][t.length%3],e=t.charCodeAt(0)<<16|(t.length>1?t.charCodeAt(1):0)<<8|(t.length>2?t.charCodeAt(2):0),n=[r.charAt(e>>>18),r.charAt(e>>>12&63),R>=2?"=":r.charAt(e>>>6&63),R>=1?"=":r.charAt(63&e)];return n.join("")},u=t.btoa?function(R){return t.btoa(R)}:function(t){return t.replace(/[\s\S]{1,3}/g,d)},l=R?function(t){return(t.constructor===R.constructor?t:new R(t)).toString("base64")}:function(t){return u(s(t))},f=function(t,R){return R?l(String(t)).replace(/[+\/]/g,function(t){return"+"==t?"-":"_"}).replace(/=/g,""):l(String(t))},v=function(t){return f(t,!0)},m=new RegExp(["[\xc0-\xdf][\x80-\xbf]","[\xe0-\xef][\x80-\xbf]{2}","[\xf0-\xf7][\x80-\xbf]{3}"].join("|"),"g"),w=function(t){switch(t.length){case 4:var R=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),e=R-65536;return o((e>>>10)+55296)+o((1023&e)+56320);case 3:return o((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return o((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},g=function(t){return t.replace(m,w)},p=function(t){var R=t.length,e=R%4,n=(R>0?a[t.charAt(0)]<<18:0)|(R>1?a[t.charAt(1)]<<12:0)|(R>2?a[t.charAt(2)]<<6:0)|(R>3?a[t.charAt(3)]:0),i=[o(n>>>16),o(n>>>8&255),o(255&n)];return i.length-=[0,0,2,1][e],i.join("")},y=t.atob?function(R){return t.atob(R)}:function(t){return t.replace(/[\s\S]{1,4}/g,p)},x=R?function(t){return(t.constructor===R.constructor?t:new R(t,"base64")).toString()}:function(t){return g(y(t))},A=function(t){return x(String(t).replace(/[-_]/g,function(t){return"-"==t?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},I=function(){var R=t.Base64;return t.Base64=e,R};if(t.Base64={VERSION:n,atob:y,btoa:u,fromBase64:A,toBase64:f,utob:s,encode:f,encodeURI:v,btou:g,decode:A,noConflict:I},"function"==typeof Object.defineProperty){var O=function(t){return{value:t,enumerable:!1,writable:!0,configurable:!0}};t.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",O(function(){return A(this)})),Object.defineProperty(String.prototype,"toBase64",O(function(t){return f(this,t)})),Object.defineProperty(String.prototype,"toBase64URI",O(function(){return f(this,!0)}))}}t.Meteor&&(Base64=t.Base64)}(this),Base64.extendString(),!function(){var t={a:"\u0430",b:"\u0431",c:"\u043a",d:"\u0434",e:"\u0435",f:"\u0444",g:"\u0491",h:"\u0433",i:"\u0456",j:"\u0439",k:"\u043a",l:"\u043b",m:"\u043c",n:"\u043d",o:"\u043e",p:"\u043f",q:"\u043a\u0432",r:"\u0440",s:"\u0441",t:"\u0442",u:"\u0443",v:"\u0432",w:"\u0432",z:"\u0437",y:"\u0438",x:"rc",ie:"\u0454",ye:"\u0454",zh:"\u0436",yi:"\u0457",kh:"\u0445",ts:"\u0446",ch:"\u0447",sh:"\u0448",shch:"\u0449",iu:"\u044e",yu:"\u044e",ia:"\u044f",ya:"\u044f"},R=function(t){var R,e,n,i,r,a=0;if(!t)return function(t){return t};r=function(R){return R in t?t[R]:R},R=Object.keys(t).sort(function(t,R){return R.length-t.length});for(;R[a]&&1!==R[a].length;a+=1);return e=R.slice(0,a).join("|"),n=R.slice(a).join(""),R=void 0,i=new RegExp([e,n?"["+n+"]":""].join(n&&e?"|":""),"g"),function(t){if("string"!=typeof t){if(!t||"function"!=typeof t.toString)return"";t=t.toString()}return t.replace(i,r)}};try{window.transliterate=R(t)}catch(e){window.transliterate=function(t){return t}}}(),!function(){function t(t){return t=Object.keys(t[0]).map(function(R){return t.map(function(t){return t[R]})}),t.reverse()}function R(t){t=Object.keys(t[0]).map(function(R){return t.map(function(t){return t[R]})});for(var R in t)t[R]=t[R].reverse();return t}var e=function(t,R){return t.slice(R,t.length).concat(t.slice(0,R))},n=function(t,R){t&&(this.canvas=t,t=t[0],this.ctx=t.getContext("2d")),this.y=0,this.x=0,this.pointSize=R||10,t&&(this.resize(),this.clear())};n.getFlowerMap=function(t,R,e,i,r,a){var o=new n;return o.w=i,o.h=r,o.clear(),o.drawFlower(t,R,e,a)},n.DICTIONARY={1:{m:[" R "," R ","RRR"]},2:{m:["RR "," R ","RRR"],lo:-1},3:{m:["  R  "," RRR ","RRRRR"],lo:-1},4:{m:[" R R ","RRRRR"," R R ","RRRRR"," R R "],lo:-1},5:{m:["R RRR","R R R","RRR R"],lo:-1},6:{m:[" RRR ","RR RR"," RRR "],lo:-1},7:{m:["  R  "," RRR "," R R ","RRRRR"],lo:-1},8:{m:["  R  "," RRR ","RR RR"," RRR ","  R  "],lo:-1},9:{m:["   R   ","  RRR  ","RRR RRR","RRRRRRR"],lo:-1},0:{m:["RRR   ","R R   ","RRR   ","   RRR","   R R","   RRR"]},10:{m:["  BB","BB  "]},100:{m:[" B ","BBB"],lo:-1},1000:{m:["BBB B "," B BBB"]}," ":{m:["  R","RRR","R  "]}," >":{m:["  R"," R ","R  "]},"\u0430":{m:["  R  "," RRR ","R   R"],p:1},"\u0430>":{m:["RRR"," RR","  R"]},"\u0431":{m:[" RR   RR ","R  R R  R"," R  R  R ","    R    "],p:2},"\u0431>":{m:["RRR  ","R R  ","  RRR"," R  R","R  RR"],p:2},"\u0432":{m:["  R  ","R R R","R R R","  R  "],p:2},"\u0432>":{m:[" R   ","R  R ","  R  "," R  R","   R "]},"\u0433":{m:[" R ","RRR","RRR"]},"\u0433>":{m:[" R R","RRR "," RRR","  R "]},"\u0453":{m:[" R ","RRR","RRR"," R "]},"\u0453>":{m:[" R R","RRR "," RRR","  R ","R   "]},"\u0434":{m:["  R  "," R R ","R R R"," RRR "]},"\u0434>":{m:["   R ","R R R","R RR "," R   "]},"\u0435":{m:["  R  ","R R R","RRRRR"]},"\u0435>":{m:[" R R","R R "," R R","  R "]},"\u0454":{m:["R R R","R R R"," RRR "]},"\u0454>":{m:["R   ","R R "," R  ","  RR"]},"\u0436":{m:["R R R"," RRR ","R R R"]},"\u0436>":{m:[" R   ","RR R ","  R  "," R RR","    R"]},"\u0437":{m:["  R  "," R R ","R R R"," R R ","  R  "]},"\u0437>":{m:["R R R"," R R ","R R R"," R R ","R R R"]},"\u0438":{m:["  R  ","R R R","RRRRR"," RRR ","  R  "]},"\u0438>":{m:[" R   ","R    ","R R  "," R  R","R RR "]},"\u0456":{m:["R"," ","R","R"]},"\u0456>":{m:["   R","    "," R  ","R   "]},"\u0457":{m:["R R","   "," R "," R "]},"\u0457>":{m:[" R  ","    "," R R","R   "]},"\u0439":{m:[" RRR ","R R R","RRRRR"," RRR ","  R  "]},"\u0439>":{m:[" R   ","R RR ","R RR "," R  R","R RR "]},"\u043a":{m:["R R"," R ","RRR"]},"\u043a>":{m:["  R ","R RR"," R  ","  R "]},"\u043b":{m:["  R  "," R R ","R   R"],p:1},"\u043b>":{m:["RRR","  R","  R"]},"\u043c":{m:["R   R","RR RR","R R R"]},"\u043c>":{m:["  R  "," RR  ","R RRR","   R ","  R  "]},"\u043d":{m:["R R","RRR","R R"]},"\u043d>":{m:[" RR  ","RR   ","R R R","   RR","  RR "]},"\u043e":{m:["RRR","R R","RRR"]},"\u043e>":{m:[" R ","R R"," R "]},"\u043f":{m:["RRR","R R","R R"]},"\u043f>":{m:[" R  ","R R ","   R","  R "]},"\u0440":{m:["  RR  "," R  R "," R R  "," R    "]},"\u0440>":{m:["  R "," R R","R RR"]},"\u0440>>":{m:[" R  ","R R ","RR R"]},"\u0440>>>":{m:[" R  ","R R ","RR R"]},"\u0441":{m:[" R ","R  "," R "]},"\u0441>":{m:["RR  ","R   "," R R","  RR"]},"\u0442":{m:["RRR"," R "]},"\u0442>":{m:["R  "," R ","R R"]},"\u0443":{m:["R   R"," R R ","  R  ","  R  "]},"\u0443>":{m:[" R  "," R  "," RRR","R   "]},"\u0444":{m:["  R  "," RRR ","R R R"," RRR ","  R  "]},"\u0444>":{m:["RR R","R R "," R R","  RR"]},"\u0445":{m:[" R ","RRR"," R "]},"\u0445>":{m:["R R"," R ","R R"]},"\u0446":{m:["R R","RRR"," R "]},"\u0446>":{m:["RR   ","R    "," R R ","R RR"]},"\u0447":{m:["RR RR"," RRR ","  R  "]},"\u0447>":{m:[" R   ","RR   ","R    "," R RR","R RR "]},"\u0448":{m:[" R   R "," R R R ","RRRRRRR"]},"\u0448>":{m:["  RR  ","RRR   "," R R R","  R RR","   RR ","    R "]},"\u0449":{m:[" R   R "," R R R "," RRRRR ","   R   "]},"\u0449>":{m:[" RR  ","RR   ","R R R"," R RR","R RR "]},"\u044e":{m:[" R ","R R"," R ","RRR"]},"\u044e>":{m:["  RRR","  R R","R RRR"," R   ","  R  "]},"\u044f":{m:["  R  "," RRR ","R R R"],p:1},"\u044f>":{m:["RRR"," RR","R R"]},"\u044c":{m:["RRR","R R"," R ","R R"]},"\u044c>":{m:[" RRR"," R R","RRRR","  R "]}};for(var i in n.DICTIONARY){var r=n.DICTIONARY[i];r.width=r.m[0].length,r.height=r.m.length,r.m=r.m.map(function(t){return t.split("")})}n.COLORS={" ":"white",R:"rgba(189, 17, 54, 0.8)",B:"rgba(189, 17, 54, 0.9)",D:"rgba(26, 7, 9, 0.8)",V:"rgba(26, 7, 9, 0.9)",O:"#feca32",BL:"#2fa6c7",G:"#58a34a"},n.digitize=function(t){var R=[],e=0;do{var n=parseInt(t%10);0!=e&&R.push(Math.pow(10,e)),R.push(n),e++,t=parseInt(t/10)}while(0!=t);return R.reverse()},n.prototype.resize=function(){if(this.canvas){var t=this.ctx,R=this.canvas[0],e=window.devicePixelRatio||1,n=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,i=e/n;if(R.style.width="auto",R.style.height="auto",e!==n){var r=$(R).width(),a=$(R).height();R.width=r*i,R.height=a*i,R.style.width=r+"px",R.style.height=a+"px",t.scale(i,i)}this.w=Math.ceil(this.canvas.width()/this.pointSize),this.h=Math.ceil(this.canvas.height()/this.pointSize)}},n.prototype.drawLine=function(t){for(var R=(t.m,t.lo||0),e=this.w/(t.width+R),n=0;e>n;n++)this.drawIcon(t),this.x+=t.width+R;this.y+=t.height+1,this.x=0},n.prototype.drawFlowerRoot=function(t,R,e,n){var i=t.p||1,r=t.width+2*t.height-2*i,a=R+(r-t.width)/2,o=e;return this.drawIcon(t,0,a,o,"R",n),this.drawIcon(t,270,R,e+t.height-i,"R",n),this.drawIcon(t,90,R+r-t.height,e+t.height-i,"R",n),this.drawIcon(t,180,a,e+t.height+t.width-2*i,"R",n),{x:R,y:e,w:r,h:2*t.height+t.width-2*i}},n.prototype.imageFor=function(t,R){return R&&(t+=">"),n.DICTIONARY[t]},n.prototype.drawFlower=function(t,R,n,i,r){i=i||"DIAGONAL_HORIZONTAL",t=transliterate(t.toLowerCase());var a,o="MULTICOLOR"==this.colorMode;if("HORIZONTAL_DIAGONAL"==i||"DIAGONAL_HORIZONTAL"==i||"DIAGONAL"==i||"HORIZONTAL"==i||"DIAGONAL_FLAT_HORIZONTAL"==i||"HORIZONTAL_DIAGONAL_FLAT"==i){for(var h=0;!this.imageFor(t[h]);)if(h++,h>t.length)return;var s=this.drawFlowerRoot(this.imageFor(t[h]+""),R,n,r);h++;for(var d=["B","R","O","G","BL"],u=0==i.indexOf("DIAGONAL"),l=0==i.indexOf("HORIZONTAL"),f=0==i.indexOf("HORIZONTAL");h<t.length;h++)this.imageFor(t[h])&&(o&&(a=d[0],d=e(d,1)),u?(o||(a=l?"R":"B"),s=this.drawDiagonalFrame(this.imageFor(t[h],!0),s,a,h*r,-1!=i.indexOf("DIAGONAL_FLAT"),"\u0440"==t[h]),l=!l):(o||(a=f?"D":"V"),c=this.drawHorizontalFrame(this.imageFor(t[h]),s,a,h*r),f=!f),("DIAGONAL_HORIZONTAL"==i||"HORIZONTAL_DIAGONAL"==i||-1!=i.indexOf("_FLAT"))&&(u=!u))}return this.m},n.prototype.drawDiagonalFrame=function(t,R,e,n,i,r){for(var a=R.x,o=R.y,h=0;this.intersect(t,i?0:270,a-h,o-h);)h++;if(r&&!i){var c=this.imageFor("\u0440>>",!0);this.drawIcon(c,0,R.x-h,R.y-h,e,n)}else this.drawIcon(t,i?0:270,R.x-h,R.y-h,e,n);if(this.drawIcon(t,i?90:180,R.x-h,R.y+R.h-t.height+h,e,n),this.drawIcon(t,i?270:0,R.x+R.w-t.width+h,R.y-h,e,n),r&&!i){var c=this.imageFor("\u0440>",!0);this.drawIcon(c,i?90:180,R.x+R.w-c.width+h,R.y+R.h-c.height+h,e,n)}else this.drawIcon(t,i?180:90,R.x+R.w-t.width+h,R.y+R.h-t.height+h,e,n);return{x:R.x-h,w:R.w+2*h,y:R.y-h,h:R.h+2*h}},n.prototype.drawSemiHorizontalFrame=function(t,R,e){for(var n=R.x,i=R.y,r=0;this.intersect(t,270,n-r,i+Math.round((R.h-t.width)/2)+3);)r++;return this.drawIcon(t,270,n-r,i+Math.ceil((R.h-t.width)/2)+3,e,interval),this.drawIcon(t,180,n+Math.ceil((R.w-t.width)/2)+3,R.y+R.h-t.height+r,e,interval),this.drawIcon(t,0,R.x+Math.ceil((R.w-t.width)/2)+3,R.y-r,e,interval),this.drawIcon(t,90,R.x+R.w-t.height+r,R.y+Math.ceil((R.h-t.width)/2)+3,e,interval),{x:R.x,w:R.w,y:R.y,h:R.h}},n.prototype.drawHorizontalFrame=function(t,R,e,n){for(var i=R.x,r=R.y,a=0;this.intersect(t,270,i-a,r+Math.round((R.h-t.width)/2));)a++;return this.drawIcon(t,270,i-a,r+Math.ceil((R.h-t.width)/2),e,n),this.drawIcon(t,180,i+Math.ceil((R.w-t.width)/2),R.y+R.h-t.height+a,e,n),this.drawIcon(t,0,R.x+Math.ceil((R.w-t.width)/2),R.y-a,e,n),this.drawIcon(t,90,R.x+R.w-t.height+a,R.y+Math.ceil((R.h-t.width)/2),e,n),{x:R.x,w:R.w,y:R.y,h:R.h}},n.prototype.drawIcon=function(e,n,i,r,a,o,h){var c=e.m,s=e.width,d=e.height;if(90==n&&h)s=l,d=u,c=R(c),c=t(c);else if(n){if(n%90!=0)throw"Only 90,180,270 degrees rotating supported";for(;n;){n-=90;var u=s,l=d;s=l,d=u,c=R(c)}}var f=r||this.y,v=i||this.x;o=o||0;for(var m=0;d>m;m++)for(var w=0;s>w;w++){var g=c[m][w];" "!=g&&(a&&(g=a),this.drawPoint(g,v+w,f+m,o?o+10*(s-w)+30*(d-m):0))}},n.prototype.clear=function(){this.ctx&&this.ctx.clearRect(0,0,this.canvas.width(),this.canvas.height()),this.m=[];for(var t=0;t<this.h;t++)this.m.push(new Array(this.w))},n.prototype.intersect=function(t,e,n,i){var r=t.m,a=t.width,o=t.height;if(e){if(e%90!=0)throw"Only 90,180,270 degrees rotating supported";for(;e;){e-=90;var h=a,c=o;a=c,o=h,r=R(r)}}for(var s=i||this.y,d=n||this.x,u=0;o>u;u++)for(var l=0;a>l;l++){var f=r[u][l];if(" "!=f&&this.m[s+u][d+l])return!0}return!1},n.prototype.drawPoint=function(t,R,e,i){if(" "!=t&&(this.m[e][R]=t),this.canvas){var r=this,a=function(){"X"==r.drawMode?r.ctx.drawImage($("#"+t+"Color")[0],R*r.pointSize,e*r.pointSize,r.pointSize+1,r.pointSize+1):"RECTANGLE"==r.drawMode?r.ctx.drawImage($("#"+t+"2Color")[0],R*r.pointSize,e*r.pointSize,r.pointSize+1,r.pointSize+1):(r.ctx.beginPath(),r.ctx.lineWidth="1.5",r.ctx.strokeStyle="rgba(0,0,0,0.05)",r.ctx.fillStyle=n.COLORS[t],r.ctx.rect(R*r.pointSize,e*r.pointSize,r.pointSize,r.pointSize),r.ctx.fill(),r.ctx.stroke())};i?setTimeout(a,i||1):a()}},window.VCanvas=n}();